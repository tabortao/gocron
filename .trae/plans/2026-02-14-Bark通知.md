# 2026-02-14 Bark 通知接入

## 目标

- 系统管理 → 通知设置：在 Server 酱³ 右侧新增 Bark 配置页，支持配置模板与 Bark 地址列表
- 任务管理 → 任务编辑：通知类型支持选择 Bark，支持选择 Bark 地址（含“全部 Bark 地址”）
- 后端：新增 Bark 通知发送实现，沿用现有 notify_type bitmask 与 notify_receiver_id typed tokens 方案

## 设计约定

- notify_type bitmask：新增 Bark = 16（即 1<<4）
- notify_receiver_id typed token：新增 `b:<id>` 与 `b:*`
- “全部 Bark 地址”哨兵：前端用 `-4` 表示，落库仍使用 `b:*`（typed token）
- Bark 请求方式：按已配置的 Bark 地址，拼接 `/{title}/{body}` 发起 GET 请求

## 实施清单

- [ ] 后端：补齐 Setting 配置项与修复逻辑（RepairSettings）
- [ ] 后端：新增 Bark 地址增删查、模板更新 API（/system/bark）
- [ ] 后端：新增 Bark 通知发送器（notify 模块）与队列分发
- [ ] 后端：通知类型 bitmask 扩展 Bark，并调整发送规则（receiver_id 为空时默认发全量 Bark）
- [ ] 前端：通知设置 Tab 增加 Bark，新增 bark.vue（模板 + 地址列表）
- [ ] 前端：任务编辑页增加 Bark 类型与 Bark 地址选择（含“全部 Bark 地址”）
- [ ] 校验：go test ./...；手工验证创建任务并触发 Bark 通知

## 回滚点

- 仅新增字段/常量与新路由、新页面，不改动既有通知类型语义；回滚时删除 Bark 相关文件与路由即可
